# Xray-Lite Usage Guide

## ğŸš€ Quick Start

### Method 1: One-Click Installation (Recommended)

Run as root:

```bash
curl -fsSL https://raw.githubusercontent.com/undead-undead/xray-lite/main/install.sh | bash
```

The script performs a binary installation without requiring Rust/Cargo environment.

### Method 2: Build from Source

```bash
git clone https://github.com/undead-undead/xray-lite.git
cd xray-lite
./deploy.sh
```

### Method 3: Manual Configuration

#### Step 1: Generate Key Pair

```bash
# Build and run the key generation tool
cargo run --bin keygen

# Example output:
# Private key: gKFubRNJ7lRLrjI0T5Jz9Q3WvYvL8B5mN2cD1xF4pHk
# Public key: xKvN8mL3pQ5rT7yU9wV1bC3dE5fG7hI9jK1lM3nO5pQ
```

#### Step 2: Generate Configuration File

```bash
# Generate configuration template
cargo run --bin genconfig > config.json

# Or create manually
```

#### Step 3: Edit Configuration

```json
{
  "inbounds": [{
    "protocol": "vless",
    "port": 443,
    "settings": {
      "clients": [{
        "id": "YOUR-UUID-HERE"
      }]
    },
    "streamSettings": {
      "security": "reality",
      "realitySettings": {
        "dest": "www.microsoft.com:443",
        "serverNames": ["www.microsoft.com"],
        "privateKey": "YOUR-PRIVATE-KEY-HERE",
        "shortIds": ["0123456789abcdef"]
      }
    }
  }]
}
```

#### Step 4: Build and Run

```bash
# Build
cargo build --release

# Run
./target/release/vless-server --config config.json
```

## ğŸ“¦ Install as System Service

### Using systemd (Linux)

```bash
# Build the project
cargo build --release

# Install service (requires root privileges)
sudo ./install_service.sh
```

Service management commands:
```bash
# Start service
sudo systemctl start xray-lite

# Stop service
sudo systemctl stop xray-lite

# Restart service
sudo systemctl restart xray-lite

# Check status
sudo systemctl status xray-lite

# View logs
sudo journalctl -u xray-lite -f
```

## ğŸ”§ Tool Usage

### 1. Key Generation Tool (keygen)

```bash
cargo run --bin keygen
```

Generates X25519 key pairs in Xray-compatible format.

### 2. Configuration Generator (genconfig)

```bash
cargo run --bin genconfig
```

Generates configuration file template.

### 3. One-Click Deployment Script (deploy.sh)

```bash
./deploy.sh
```

Automatically completes all configuration and compilation steps.

## ğŸ“± Client Configuration

### Xray Client

Use the `client-config.json` generated by `deploy.sh`:

```bash
xray run -c client-config.json
```

### v2rayN (Windows)

1. Open v2rayN
2. Add server
3. Select VLESS protocol
4. Configure parameters:
   - Address: Your server IP
   - Port: 443
   - UUID: From configuration file
   - Transport: TCP
   - Security: Reality
   - Public Key: From keygen
   - ServerName: www.microsoft.com
   - Short ID: 0123456789abcdef

### v2rayNG (Android)

Similar to v2rayN configuration.

## ğŸ§ª Testing

### Basic Functionality Test

```bash
./test_reality_basic.sh
```

Test contents:
- Build check
- Unit tests
- Server startup
- Port listening

### Integration Test (requires Xray)

```bash
# Install Xray
bash -c "$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)" @ install

# Run integration test
./test_xray_integration.sh
```

### Manual Testing

```bash
# Start server
./target/release/vless-server --config config.json &

# Start Xray client in another terminal
xray run -c client-config.json &

# Test connection
curl -x socks5://127.0.0.1:1080 https://www.google.com
```

## ğŸ› Troubleshooting

### Issue 1: Build Failure

```bash
# Update Rust
rustup update

# Clean and rebuild
cargo clean
cargo build --release
```

### Issue 2: Connection Failure

Checklist:
1. âœ… Is the firewall port open?
2. âœ… Is the configuration correct?
3. âœ… Do the keys match?
4. âœ… Is the Short ID consistent?

View logs:
```bash
# Enable detailed logging
RUST_LOG=debug ./target/release/vless-server --config config.json

# Or view systemd logs
sudo journalctl -u xray-lite -f
```

### Issue 3: Performance Issues

```bash
# Use release mode
cargo build --release

# Check system resources
htop

# Check connection count
netstat -an | grep :443 | wc -l
```

## ğŸ“Š Performance Optimization

### Build Optimization

Already configured in `Cargo.toml`:
```toml
[profile.release]
opt-level = 3
lto = true
codegen-units = 1
strip = true
```

### System Optimization

```bash
# Increase file descriptor limit
ulimit -n 1000000

# Optimize TCP parameters
sysctl -w net.core.rmem_max=26214400
sysctl -w net.core.wmem_max=26214400
```

## ğŸ”’ Security Recommendations

1. **Key Management**
   - Keep private keys secure
   - Rotate keys regularly
   - Don't share configurations publicly

2. **Firewall Configuration**
   ```bash
   # Only open necessary ports
   ufw allow 443/tcp
   ufw enable
   ```

3. **Regular Updates**
   ```bash
   git pull
   cargo build --release
   sudo systemctl restart xray-lite
   ```

## ğŸ“š More Documentation

- [DESIGN.md](DESIGN.md) - Architecture design
- [README.md](README.md) - Project introduction

## ğŸ†˜ Getting Help

- GitHub Issues: [Submit an issue](https://github.com/undead-undead/xray-lite/issues)
- View logs: `sudo journalctl -u xray-lite -f`
- Detailed logs: `RUST_LOG=debug cargo run`

## ğŸ“„ License

MIT License - See [LICENSE](LICENSE) file for details
